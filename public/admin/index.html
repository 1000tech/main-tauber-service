<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dienstleistungen.Main-Tauber-Kreis Admin</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/hithismani/responsive-decap@main/dist/responsive.min.css">
    </head>
    <body>
        <!-- Decap CMS -->
        <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
        <script>
            // Listen for OAuth messages
            window.addEventListener('message', function(event) {
                if (event.data && typeof event.data === 'string') {
                    if (event.data.startsWith('authorization:github:success:')) {
                        const token = event.data.replace('authorization:github:success:', '');
                        
                        // Store token
                        localStorage.setItem('decap-cms-user', JSON.stringify({
                            backendName: 'github',
                            token: token
                        }));
                        
                        // Reload to let Decap CMS handle it
                        setTimeout(() => window.location.reload(), 500);
                    } else if (event.data.startsWith('authorization:github:error:')) {
                        alert('Authentication failed: ' + event.data);
                    }
                }
            });
            
            // Initialize Decap CMS
            setTimeout(function() {
                if (window.CMS) {
                    // Decap CMS should automatically load /admin/config.yml
                }
            }, 1000);
        </script>
    </body>
</html>
